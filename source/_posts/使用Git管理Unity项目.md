---
title: 使用Git管理Unity项目
abbrlink: 1f15053a
date: 2022-07-18 09:25:38
tags: 
  - Git
  - Unity
categories: 技术文档
cover: "http://soincredible777.com.cn:90/6.png"
description: 
---

# 了解Unity的目录结构

![](使用Git管理Unity项目/image-20220718093817361.png)

官方参考文档https://docs.unity3d.com/Manual/ExternalVersionControlSystemSupport.html

- Assets：存储所有游戏资源的文件夹，包括脚本、纹理、声音、<code>编辑器定制</code>等等。是项目中最重要的文件夹。
- Library：被导入资源的本地缓存，使用Git做版本控制时不需要管这个文件夹。如果Unity的项目文件太大，可以试试删除Library文件夹
- Logs：日志文件夹，由Unity自动生成管理，记录报错崩溃信息，随时可以删除清理
- Packages：包配置信息，由Unity自动生成管理，用于放置一些官方组件和第三方插件
- ProjectSettings：工程设置信息，由Unity自动生成管理
- UserSettings：编辑器的用户构建设置，记录用户的使用偏好，如Unity编辑器的布局方式等等。
- Temp：临时文件夹，Unity运行过程中生成的历史文件。

综上，我们只需要将Assets和ProjectSettings两个文件夹纳入版本控制即可，通过编辑<code>.gitignore</code>文件忽略不需要版本控制的文件。这里列出最近在学习的ARFoundation在github上给出的例子的<code>.gitignore</code>为例：

```shell
[Ll]ibrary/
[Ll]ogs/
[Tt]emp/
[Oo]bj/
[Bb]uild/
[Bb]uilds/
[Uu]serSettings/
Assets/AssetStoreTools*
Packages/packages-lock.json

# Visual Studio 2015 cache directory
/.vs/
.vscode

# Ignore manually added packages
com.*
upm-xr*

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
.consulo/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd
*.pdb
*.idea
.vsconfig

# Unity3D generated meta files
*.pidb.meta
*.pdb.meta

# Unity3D Generated File On Crash Reports
sysinfo.txt

# Builds
*.apk
*.unitypackage

.DS_Store
```

https://github.com/github/gitignore/blob/main/Unity.gitignore

```shell
# This .gitignore file should be placed at the root of your Unity project directory
#
# Get latest from https://github.com/github/gitignore/blob/main/Unity.gitignore
#
/[Ll]ibrary/
/[Tt]emp/
/[Oo]bj/
/[Bb]uild/
/[Bb]uilds/
/[Ll]ogs/
/[Uu]ser[Ss]ettings/

# MemoryCaptures can get excessive in size.
# They also could contain extremely sensitive data
/[Mm]emoryCaptures/

# Recordings can get excessive in size
/[Rr]ecordings/

# Uncomment this line if you wish to ignore the asset store tools plugin
# /[Aa]ssets/AssetStoreTools*

# Autogenerated Jetbrains Rider plugin
/[Aa]ssets/Plugins/Editor/JetBrains*

# Visual Studio cache directory
.vs/

# Gradle cache directory
.gradle/

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
.consulo/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd
*.pdb
*.mdb
*.opendb
*.VC.db

# Unity3D generated meta files
*.pidb.meta
*.pdb.meta
*.mdb.meta

# Unity3D generated file on crash reports
sysinfo.txt

# Builds
*.apk
*.aab
*.unitypackage
*.app

# Crashlytics generated file
crashlytics-build.properties

# Packed Addressables
/[Aa]ssets/[Aa]ddressable[Aa]ssets[Dd]ata/*/*.bin*

# Temporary auto-generated Android Assets
/[Aa]ssets/[Ss]treamingAssets/aa.meta
/[Aa]ssets/[Ss]treamingAssets/aa/*

```

但是每一次给Unity项目创建Git仓库的时候都需要手动生成这个`.gitigonre`文件，非常地麻烦，但是我们可以在终端编写一个命令在自动生成`.ginignore`文件，在Mac和Windosw上操作有所不同。

## Mac

在Mac的终端中，我们可以通过创建一个Shell脚本或简单地定义一个别名来实现自定义命令。我的Mac是Zsh环境：

1. 打开`.zshrc`

   ```bash
   vim ~/.zshrc
   ```

2. 添加如下内容：

   ```bash
   generate_gitignore_unity() {
     curl https://raw.githubusercontent.com/github/gitignore/master/Unity.gitignore -o .gitignore
   }
   ```

3. 保存并退出编辑器，重新加载配置文件以应用更改

   ```bash
   source ~/.zshrc
   ```

现在，我们在创建了一个新的Unity项目后，去到该项目的根目录下，使用`generate_gitignore_unity`就可以生成`.gitignore`文件了。

## Windows

在Windows的PowerShell环境下，我们可以通过创建一个自定义函数来实现类似的功能：

1. 打开WindowsPowerShell

2. 创建一个名为`Microsoft.PowerShell_profile.ps1`的Profile文件

   ```powershell
   if (!(Test-Path -Path $PROFILE)) {
       New-Item -Type File -Path $PROFILE -Force
   }
   ```

3. 使用文本编辑器打开`Microsoft.PowerShell_profile.ps1`文件，我们可以在PowerShell中输入`$PROFILE`找到文件的路径

4. 将下面的内容添加到其中：

   ```powershell
   function Generate-Gitignore-Unity {
       Invoke-WebRequest -Uri "https://raw.githubusercontent.com/github/gitignore/master/Unity.gitignore" -OutFile ".gitignore"
   }
   ```

5. 保存文件并退出编辑器，重启PowerShell窗口或者执行以下命令使更改生效：

   ```powershell
   . $Profile
   ```

现在我们在PowerShell窗口中输入`Generate-Gitignore-Unity`就可以生成`.gitignore`了

不过在近期的使用中我发现，`gitigonre`的文件内容是从github上获取的，对网络质量要求高，有可能会创建失败；而且由于我使用的编辑器是Rider，项目文件夹中会有一个.idea的文件夹并没有被列入gitignore中，当然我们可以在生成了gitignore文件之后再将这个文件夹加入到文件的末尾，但是还是太繁琐了，所以我们修改一下创建`gitignore`文件的方式，我们将Mac和Windows对应的Shell脚本和PowerShell脚本中`Generate_Gitignore_Unity`方法的内容替换：

**Mac**

```bash
echo "# Unity .gitignore file

[Ll]ibrary/
[Tt]emp/
[Oo]bj/
[Bb]uild/
[Bb]uilds/
Assets/AssetStoreTools*

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd

*.dll.mdb
*.exe.mdb
*.mdb
*.pdb

*.bak
*/symlink
*.swp
*.swf

# Visual Studio cache directory
.vs/

# JetBrains Rider cache files & settings
.idea/
*.DotSettings.user

# macOS-specific files
.DS_Store
._*
Icon?
*.bak.osx
*.gmk.osx
.cs.meta

# Thumbnails
[Systeme][Cc]ache/
[Tt]humbs.db
*.stackdump

# Cache files for various systems
library-*
.sln.docstates
.expressionblend
Tmp_*
_StyleCop.Cache
.idea/" >> .gitignore

```

**Windows**

```powershell
@'
# Unity .gitignore file

[Ll]ibrary/
[Tt]emp/
[Oo]bj/
[Bb]uild/
[Bb]uilds/
Assets/AssetStoreTools*

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd

*.dll.mdb
*.exe.mdb
*.mdb
*.pdb

*.bak
*/symlink
*.swp
*.swf

# Visual Studio cache directory
.vs/

# JetBrains Rider cache files & settings
.idea/
*.DotSettings.user

# macOS-specific files
.DS_Store
._*
Icon?
*.bak.osx
*.gmk.osx
.cs.meta

# Thumbnails
[Systeme][Cc]ache/
[Tt]humbs.db
*.stackdump

# Cache files for various systems
library-*
.sln.docstates
.expressionblend
Tmp_*
_StyleCop.Cache
./idea
'@ | Set-Content -Path ".gitignore" -Encoding utf8

```

如果之后还有需要忽略的文件，在这两段内容的末尾添加我们要忽略的文件名即可。



# 使用SourceTree管理Unity项目

`SourceTree`是带有可视化界面的`Git`，有了它能够大大提高我们版本管理的效率，下面记录的是我在使用`SourceTree`面对一些较为复杂的使用场景时的基本流程，为之后遇到类似流程做一个参照。

## 在Windows上使用SourceTree执行git命令有如下报错

```
The host key is not cached for this server:
 gitee.com(port22)
You have no guarantee that the server is the computer
you think it is
The server's ssh-ed25519 key fingerprint is:
	.................................
if you trust this host, enter "y" to add thie key to

```

打开Windows版的SourceTree，在菜单栏中选择`工具``->``选项``->``一般``->``SSH客户端配置``->``SSH客户端`选择`OpenSSH`就可以解决问题 。

## 使用SourceTree实现在一个项目中向两个云端仓库同步更新版本

**需求描述：**我们Bubble项目的远程仓库部署在Gerrit上，我已经将它拉取下来创建了本地的仓库，由于我需要学习和熟悉项目，为了检验学习成果我会在项目中创建很多和需求无关的脚本或做一些修改，我不想将这些内容丢弃，但又不能上传到Gerrit上污染了远端的仓库，所以我打算将我所做修改上传到我自己的`gitee`仓库中。有两点好处，首先我保存了我为了学习所做的修改，可以时常回顾；其次我实现了多设备同步更新，在公司没有学完的知识回家可以继续学。我自己学习用的分支名为`Learn`分支，它远端的仓库是`gitee`仓库，开发分支是`master`，对应`Gerrit`仓库。同步的基本流程如下：以向gitee仓库中提交Learn分支所做修改为例，阐述基本的流程：

1. 从`gitee`上拉取到最新的`Learn`分支，
2. 在本地创建了很多脚本或者修改了Prefab的属性等等
3. 修改完成之后，切换到`master`分支上，从Gerrit仓库中拉取最新的`master`分支到本地
4. 切换回`Learn`分支，将刚拉取到的最新的`master`分支合并到`Learn`分支上
5. 提交并推送所做的修改到`gitee`仓库，完成版本更新

## 使用SourceTree在错误的分支上做了修改，如何将修改从错误的分支转移到正确的分支上？

紧接着上面那个在一个项目中向两个云端仓库同步更新版本的例子使用场景，我极有可能在`Learn`分支上进行学习的时候突然要修复一个bug或者完成新的需求，但是我忘记切换分支到`master`上，于是我在`Learn`分支上完成的代码的编写，在这种情况下，我希望将我在`Learn`分支上做的修改转移到`master`分支上，需要使用贮藏`stash`的功能，基本流程如下：

1. 当前分支是`Learn`，确保需要更改分支的内容都处于未提交`commit`的状态
2. 选中需要更改分支的内容，点击贮藏`stash`
3. 切换到`master`分支上，应用刚才生成的贮藏，就将在`Learn`分支上做的修改移动到了`master`分支上
4. 提交到远程仓库

