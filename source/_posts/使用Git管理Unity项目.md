---
title: 使用Git管理Unity项目
abbrlink: 1f15053a
date: 2022-07-18 09:25:38
tags: 
  - Git
  - Unity
categories: 技术文档
cover: "http://soincredible777.com.cn:90/6.png"
description: 
---

# 了解Unity的目录结构

![](使用Git管理Unity项目/image-20220718093817361.png)

官方参考文档https://docs.unity3d.com/Manual/ExternalVersionControlSystemSupport.html

- Assets：存储所有游戏资源的文件夹，包括脚本、纹理、声音、<code>编辑器定制</code>等等。是项目中最重要的文件夹。
- Library：被导入资源的本地缓存，使用Git做版本控制时不需要管这个文件夹。如果Unity的项目文件太大，可以试试删除Library文件夹
- Logs：日志文件夹，由Unity自动生成管理，记录报错崩溃信息，随时可以删除清理
- Packages：包配置信息，由Unity自动生成管理，用于放置一些官方组件和第三方插件
- ProjectSettings：工程设置信息，由Unity自动生成管理
- UserSettings：编辑器的用户构建设置，记录用户的使用偏好，如Unity编辑器的布局方式等等。
- Temp：临时文件夹，Unity运行过程中生成的历史文件。

综上，我们只需要将Assets和ProjectSettings两个文件夹纳入版本控制即可，通过编辑<code>.gitignore</code>文件忽略不需要版本控制的文件。这里列出最近在学习的ARFoundation在github上给出的例子的<code>.gitignore</code>为例：

```shell
[Ll]ibrary/
[Ll]ogs/
[Tt]emp/
[Oo]bj/
[Bb]uild/
[Bb]uilds/
[Uu]serSettings/
Assets/AssetStoreTools*
Packages/packages-lock.json

# Visual Studio 2015 cache directory
/.vs/
.vscode

# Ignore manually added packages
com.*
upm-xr*

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
.consulo/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd
*.pdb
*.idea
.vsconfig

# Unity3D generated meta files
*.pidb.meta
*.pdb.meta

# Unity3D Generated File On Crash Reports
sysinfo.txt

# Builds
*.apk
*.unitypackage

.DS_Store
```

https://github.com/github/gitignore/blob/main/Unity.gitignore

```shell
# This .gitignore file should be placed at the root of your Unity project directory
#
# Get latest from https://github.com/github/gitignore/blob/main/Unity.gitignore
#
/[Ll]ibrary/
/[Tt]emp/
/[Oo]bj/
/[Bb]uild/
/[Bb]uilds/
/[Ll]ogs/
/[Uu]ser[Ss]ettings/

# MemoryCaptures can get excessive in size.
# They also could contain extremely sensitive data
/[Mm]emoryCaptures/

# Recordings can get excessive in size
/[Rr]ecordings/

# Uncomment this line if you wish to ignore the asset store tools plugin
# /[Aa]ssets/AssetStoreTools*

# Autogenerated Jetbrains Rider plugin
/[Aa]ssets/Plugins/Editor/JetBrains*

# Visual Studio cache directory
.vs/

# Gradle cache directory
.gradle/

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
.consulo/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd
*.pdb
*.mdb
*.opendb
*.VC.db

# Unity3D generated meta files
*.pidb.meta
*.pdb.meta
*.mdb.meta

# Unity3D generated file on crash reports
sysinfo.txt

# Builds
*.apk
*.aab
*.unitypackage
*.app

# Crashlytics generated file
crashlytics-build.properties

# Packed Addressables
/[Aa]ssets/[Aa]ddressable[Aa]ssets[Dd]ata/*/*.bin*

# Temporary auto-generated Android Assets
/[Aa]ssets/[Ss]treamingAssets/aa.meta
/[Aa]ssets/[Ss]treamingAssets/aa/*

```

但是每一次给Unity项目创建Git仓库的时候都需要手动生成这个`.gitigonre`文件，非常地麻烦，但是我们可以在终端编写一个命令在自动生成`.ginignore`文件，在Mac和Windosw上操作有所不同。

## Mac

在Mac的终端中，我们可以通过创建一个Shell脚本或简单地定义一个别名来实现自定义命令。我的Mac是Zsh环境：

1. 打开`.zshrc`

   ```bash
   vim ~/.zshrc
   ```

2. 添加如下内容：

   ```bash
   generate_gitignore_unity() {
     curl https://raw.githubusercontent.com/github/gitignore/master/Unity.gitignore -o .gitignore
   }
   ```

3. 保存并退出编辑器，重新加载配置文件以应用更改

   ```bash
   source ~/.zshrc
   ```

现在，我们在创建了一个新的Unity项目后，去到该项目的根目录下，使用`generate_gitignore_unity`就可以生成`.gitignore`文件了。

## Windows

在Windows的PowerShell环境下，我们可以通过创建一个自定义函数来实现类似的功能：

1. 打开WindowsPowerShell

2. 创建一个名为`Microsoft.PowerShell_profile.ps1`的Profile文件

   ```powershell
   if (!(Test-Path -Path $PROFILE)) {
       New-Item -Type File -Path $PROFILE -Force
   }
   ```

3. 使用文本编辑器打开`Microsoft.PowerShell_profile.ps1`文件，我们可以在PowerShell中输入`$PROFILE`找到文件的路径

4. 将下面的内容添加到其中：

   ```powershell
   function Generate-Gitignore-Unity {
       Invoke-WebRequest -Uri "https://raw.githubusercontent.com/github/gitignore/master/Unity.gitignore" -OutFile ".gitignore"
   }
   ```

5. 保存文件并退出编辑器，重启PowerShell窗口或者执行以下命令使更改生效：

   ```powershell
   . $Profile
   ```

现在我们在PowerShell窗口中输入`Generate-Gitignore-Unity`就可以生成`.gitignore`了

不过在近期的使用中我发现，`gitigonre`的文件内容是从github上获取的，对网络质量要求高，有可能会创建失败；而且由于我使用的编辑器是Rider，项目文件夹中会有一个.idea的文件夹并没有被列入gitignore中，当然我们可以在生成了gitignore文件之后再将这个文件夹加入到文件的末尾，但是还是太繁琐了，所以我们修改一下创建`gitignore`文件的方式，我们将Mac和Windows对应的Shell脚本和PowerShell脚本中`Generate_Gitignore_Unity`方法的内容替换：

**Mac**

```bash
echo "# Unity .gitignore file

[Ll]ibrary/
[Tt]emp/
[Oo]bj/
[Bb]uild/
[Bb]uilds/
Assets/AssetStoreTools*

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd

*.dll.mdb
*.exe.mdb
*.mdb
*.pdb

*.bak
*/symlink
*.swp
*.swf

# Visual Studio cache directory
.vs/

# JetBrains Rider cache files & settings
.idea/
*.DotSettings.user

# macOS-specific files
.DS_Store
._*
Icon?
*.bak.osx
*.gmk.osx
.cs.meta

# Thumbnails
[Systeme][Cc]ache/
[Tt]humbs.db
*.stackdump

# Cache files for various systems
library-*
.sln.docstates
.expressionblend
Tmp_*
_StyleCop.Cache
.idea/" >> .gitignore

```

**Windows**

```powershell
@'
# Unity .gitignore file

[Ll]ibrary/
[Tt]emp/
[Oo]bj/
[Bb]uild/
[Bb]uilds/
Assets/AssetStoreTools*

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd

*.dll.mdb
*.exe.mdb
*.mdb
*.pdb

*.bak
*/symlink
*.swp
*.swf

# Visual Studio cache directory
.vs/

# JetBrains Rider cache files & settings
.idea/
*.DotSettings.user

# macOS-specific files
.DS_Store
._*
Icon?
*.bak.osx
*.gmk.osx
.cs.meta

# Thumbnails
[Systeme][Cc]ache/
[Tt]humbs.db
*.stackdump

# Cache files for various systems
library-*
.sln.docstates
.expressionblend
Tmp_*
_StyleCop.Cache
./idea
'@ | Set-Content -Path ".gitignore" -Encoding utf8

```

如果之后还有需要忽略的文件，在这两段内容的末尾添加我们要忽略的文件名即可。



# 使用SourceTree管理Unity项目

SourceTree不过就是Git的可视化版，下面举几个在开发中碰到的场景

1.在Windows系统上面更改连接方式为OpenSSH

2.我在使用sourcetree的时候，有以下的使用场景：我现在有两个云端仓库A和B，远程仓库A是我们公司项目的仓库，而远程仓库B是我自己的个人仓库，我在本地有两个分支：learn和master，learn分支是我自己学习使用的分支，在这个分支上我会做很多和公司项目需求无关的内容，所以不能上传到远程仓库A中去，但我又想能在多设备上进行learn分支的开发，所以我将该分支的内容上传到了我自己的仓库B中去，master分支是我们公司项目开发所用的分支，这个分支需要和云端仓库A时刻保持同步，我现在希望我的learn分支除了能够存储我自己所做的所有更改，同时也囊括master分支上所有的修改，然后将learn分支的内容上传到云端仓库B中去，我该怎么做？

你可以使用如下步骤实现你的需求：

1. 首先确保在 SourceTree 中添加了两个远程仓库：A（公司项目）和 B（个人仓库）。可以在 Repository Settings 中添加新的远程仓名。
2. 在 SourceTree 中切换到 master 分支，并从远程仓库 A 拉取最新的更改：

```
复制代码git checkout master
git pull A master
```

1. 切换回 learn 分支，然后将 master 分支的修改合并到 learn 分支：

```
复制代码git checkout learn
git merge master
```

在这一步中，如果有任何冲突，需要手动解决并提交修改。

1. 确保本地 learn 分支包含 master 分支上的所有更改。现在，你可以将 learn 分支推送到个人远程仓库 B：

```
复制代码git push B learn
```

这样，你就可以将本地 learn 分支的所有更改（包括 master 分支的同步）上传到远程个人仓库 B。注意每次 master 分支有新更改时，你需要重复这些步骤以使 learn 分支保持更新。

3.我使用SourceTree在错误的分支上做了修改，我怎么把我在错误的分支上做的修改转移到正确的分支上

要将在错误分支上的修改转移到正确分支，请按照以下步骤操作：

1. 在错误分支上，使用`git stash save`命令保存当前的更改。这会将你的更改暂时存储起来。

```
复制代码   git stash save "我的修改"
```

1. 切换到正确的分支。

```
复制代码   git checkout 正确分支
```

1. 使用`git stash apply`将暂存的更改应用到正确的分支。

```
复制代码   git stash apply
```

1. 如果一切顺利，提交更改：

```
复制代码   git add .
   git commit -m "将修改转移到正确分支"
```

1. （可选）删除在错误分支上创建的暂存点（如果不再需要），运行：

```
复制代码   git stash drop
```

