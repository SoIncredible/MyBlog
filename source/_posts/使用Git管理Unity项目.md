---
title: 使用Git管理Unity项目
abbrlink: 1f15053a
date: 2022-07-18 09:25:38
tags: 
  - Git
  - Unity
categories: 技术文档
cover: "139.224.82.218:90/6.png"
description: 
sticky: 2
swiper_index: 4
---

# 了解Unity的目录结构

![](使用Git管理Unity项目/image-20220718093817361.png)

官方参考文档https://docs.unity3d.com/Manual/ExternalVersionControlSystemSupport.html

- Assets：存储所有游戏资源的文件夹，包括脚本、纹理、声音、<code>编辑器定制</code>等等。是项目中最重要的文件夹。
- Library：被导入资源的本地缓存，使用Git做版本控制时不需要管这个文件夹。如果Unity的项目文件太大，可以试试删除Library文件夹
- Logs：日志文件夹，由Unity自动生成管理，记录报错崩溃信息，随时可以删除清理
- Packages：包配置信息，由Unity自动生成管理，用于放置一些官方组件和第三方插件
- ProjectSettings：工程设置信息，由Unity自动生成管理
- UserSettings：编辑器的用户构建设置，记录用户的使用偏好，如Unity编辑器的布局方式等等。
- Temp：临时文件夹，Unity运行过程中生成的历史文件。

[这里](https://github.com/github/gitignore/blob/main/Unity.gitignore)是github官方提供的不同工程中gitignore中的内容，但是参考价值不大，我们自己项目工程文件的方式很多样（当然Unity工程文件夹下的基本结构是不变的，我们可能会在工程文件夹之外上传很多我们自己的文件）

2023.07.13更新

现在我希望这个命令可以更加全能一些，它能够帮助我创建git仓库、创建gitignore、创建README文件一体的命令，我将这个命令命名为

但是每一次给Unity项目创建Git仓库的时候都需要手动生成这个`.gitigonre`文件，非常地麻烦，但是我们可以在终端编写一个命令在自动生成`.ginignore`文件，在Mac和Windosw上操作有所不同。

## Mac

在Mac的终端中，我们可以通过创建一个Shell脚本或简单地定义一个别名来实现自定义命令。我的Mac是Zsh环境：

1. 打开`.zshrc`

   ```bash
   vim ~/.zshrc
   ```

2. 添加如下内容：

   ```bash
   generate-unity-gitignore() {
     curl https://raw.githubusercontent.com/github/gitignore/master/Unity.gitignore -o .gitignore
   }
   ```

3. 保存并退出编辑器，重新加载配置文件以应用更改

   ```bash
   source ~/.zshrc
   ```

现在，我们在创建了一个新的Unity项目后，去到该项目的根目录下，使用`generate-unity-gitignore`就可以生成`.gitignore`文件了。

## Windows

在Windows的PowerShell环境下，我们可以通过创建一个自定义函数来实现类似的功能：

1. 打开WindowsPowerShell

2. 创建一个名为`Microsoft.PowerShell_profile.ps1`的Profile文件

   ```powershell
   if (!(Test-Path -Path $PROFILE)) {
       New-Item -Type File -Path $PROFILE -Force
   }
   ```

3. 使用文本编辑器打开`Microsoft.PowerShell_profile.ps1`文件，我们可以在PowerShell中输入`$PROFILE`找到文件的路径

4. 将下面的内容添加到其中：

   ```powershell
   function generate-unity-gitignore {
       Invoke-WebRequest -Uri "https://raw.githubusercontent.com/github/gitignore/master/Unity.gitignore" -OutFile ".gitignore"
   }
   ```

5. 保存文件并退出编辑器，重启PowerShell窗口或者执行以下命令使更改生效：

   ```powershell
   . $Profile
   ```

现在我们在PowerShell窗口中输入`generate-unity-gitignore`就可以生成`.gitignore`了

不过在近期的使用中我发现，`gitigonre`的文件内容是从github上获取的，对网络质量要求高，有可能会创建失败；而且由于我使用的编辑器是Rider，项目文件夹中会有一个.idea的文件夹并没有被列入gitignore中，当然我们可以在生成了gitignore文件之后再将这个文件夹加入到文件的末尾，但是还是太繁琐了，所以我们修改一下创建`gitignore`文件的方式，我们将Mac和Windows对应的Shell脚本和PowerShell脚本中`generate-unity-gitignore`方法的内容替换：

2023.07.13更新：经过在公司的学习和自己平时的开发使用，我们现在将这个功能扩展，因为我们使用Git管理的根文件夹可能不仅仅是一个Unity的工程的根目录，因此之前的gitignore文件存在一定的局限性，因此我在之前的文件基础上增加一些拓展性更高的方案

**Mac**

```bash
echo "# Unity .gitignore file

/[Ll]ibrary/
/[Tt]emp/
/[Oo]bj/
/[Bb]uild/
/[Bb]uilds/
/[Ll]ogs/
/[Uu]ser[Ss]ettings/
Assets/AssetStoreTools*

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd

*.dll.mdb
*.exe.mdb
*.mdb
*.pdb

*.bak
*/symlink
*.swp
*.swf

# Visual Studio cache directory
.vs/

# JetBrains Rider cache files & settings
.idea/
*.DotSettings.user

# macOS-specific files
.DS_Store
._*
Icon?
*.bak.osx
*.gmk.osx
.cs.meta

# Thumbnails
[Systeme][Cc]ache/
[Tt]humbs.db
*.stackdump

# Cache files for various systems
library-*
.sln.docstates
.expressionblend
Tmp_*
_StyleCop.Cache
.idea/
.vsconfig
" >> .gitignore

```

**Windows**

```powershell
@'
# Unity .gitignore file

/[Ll]ibrary/
/[Tt]emp/
/[Oo]bj/
/[Bb]uild/
/[Bb]uilds/
/[Ll]ogs/
/[Uu]ser[Ss]ettings/
Assets/AssetStoreTools*

# Autogenerated VS/MD/Consulo solution and project files
ExportedObj/
*.csproj
*.unityproj
*.sln
*.suo
*.tmp
*.user
*.userprefs
*.pidb
*.booproj
*.svd

*.dll.mdb
*.exe.mdb
*.mdb
*.pdb

*.bak
*/symlink
*.swp
*.swf

# Visual Studio cache directory
.vs/

# JetBrains Rider cache files & settings
.idea/
*.DotSettings.user

# macOS-specific files
.DS_Store
._*
Icon?
*.bak.osx
*.gmk.osx
.cs.meta

# Thumbnails
[Systeme][Cc]ache/
[Tt]humbs.db
*.stackdump

# Cache files for various systems
library-*
.sln.docstates
.expressionblend
Tmp_*
_StyleCop.Cache
./idea
.vsconfig
'@ | Set-Content -Path ".gitignore" -Encoding utf8

```

如果之后还有需要忽略的文件，在这两段内容的末尾添加我们要忽略的文件名即可。

# 使用SourceTree管理Unity项目

`SourceTree`是带有可视化界面的`Git`，有了它能够大大提高我们版本管理的效率，下面记录的是我在使用`SourceTree`面对一些较为复杂的使用场景时的基本流程，为之后遇到类似流程做一个参照。

## 在Windows上使用SourceTree执行git命令有如下报错

```
The host key is not cached for this server:
 gitee.com(port22)
You have no guarantee that the server is the computer
you think it is
The server's ssh-ed25519 key fingerprint is:
	.................................
if you trust this host, enter "y" to add thie key to
```

打开Windows版的SourceTree，在菜单栏中选择`工具``->``选项``->``一般``->``SSH客户端配置``->``SSH客户端`选择`OpenSSH`就可以解决问题 。

## 使用SourceTree实现在一个项目中向两个云端仓库同步更新版本

**需求描述：**我们Bubble项目的远程仓库部署在Gerrit上，我已经将它拉取下来创建了本地的仓库，由于我需要学习和熟悉项目，为了检验学习成果我会在项目中创建很多和需求无关的脚本或做一些修改，我不想将这些内容丢弃，但又不能上传到Gerrit上污染了远端的仓库，所以我打算将我所做修改上传到我自己的`gitee`仓库中。有两点好处，首先我保存了我为了学习所做的修改，可以时常回顾；其次我实现了多设备同步更新，在公司没有学完的知识回家可以继续学。我自己学习用的分支名为`Learn`分支，它远端的仓库是`gitee`仓库，开发分支是`master`，对应`Gerrit`仓库。同步的基本流程如下：以向gitee仓库中提交Learn分支所做修改为例，阐述基本的流程：

1. 从`gitee`上拉取到最新的`Learn`分支，
2. 在本地创建了很多脚本或者修改了Prefab的属性等等
3. 修改完成之后，切换到`master`分支上，从Gerrit仓库中拉取最新的`master`分支到本地
4. 切换回`Learn`分支，将刚拉取到的最新的`master`分支合并到`Learn`分支上
5. 提交并推送所做的修改到`gitee`仓库，完成版本更新

## 使用SourceTree在错误的分支上做了修改，如何将修改从错误的分支转移到正确的分支上？

紧接着上面那个在一个项目中向两个云端仓库同步更新版本的例子使用场景，我极有可能在`Learn`分支上进行学习的时候突然要修复一个bug或者完成新的需求，但是我忘记切换分支到`master`上，于是我在`Learn`分支上完成的代码的编写，在这种情况下，我希望将我在`Learn`分支上做的修改转移到`master`分支上，需要使用贮藏`stash`的功能，基本流程如下：

1. 当前分支是`Learn`，确保需要更改分支的内容都处于未提交`commit`的状态
2. 选中需要更改分支的内容，点击贮藏`stash`
3. 切换到`master`分支上，应用刚才生成的贮藏，就将在`Learn`分支上做的修改移动到了`master`分支上
4. 提交到远程仓库

## gitignore没有生效，将本应该ignore的文件提交了该怎么办？

今天在使用`generate-unity-gitignore`方法在终端中生成gitignore文件的时候，在提交的时候发现gitignore文件好像并没有生效，提交了大量Library和Logs文件夹中的文件，导致`git add .`操作卡了好久，但是已经将不该提交的文件提交上去了，解决方案如下：

1.删除掉原来的.gitignore文件

2.创建新的.gitignore文件并且确保格式正确、要忽略的文件填写正确

3.清除已经被跟踪的文件缓存，如果要递归地删除文件夹，记得使用`-r`选项，`<directory_path>`要替换成Unity项目的根路径。

```shell
git rm -r --cached <directory_path>
```

4.提交更改，git常规三件套：`add`、`commit`、`push`

一般情况下这种问题只会出现在第一次提交的时候，而在SourceTree中在只有一次提交的情况下没有办法撤回，具体做法是，将已经提交的但是不需要追踪的文件删除掉，在SourceTree中就做了一次更改，然后提交一次

然后更新新的gitignore文件，然后撤销删除

而在SourceTree当中的操作方法是：我们首先要将.gitignore文件更新到正确的内容，然后将.gitignore文件贮藏起来，选中我们错误的那次提交记录。

Git钩子的使用

在开发过程中，我经常需要更改本地的时间去测试一些活动的功能是否正常，这导致了我很可能在没有将时间调整回来就在错误的时间下将本地的修改进行了提交，因为我们的每次提交的时间会被记录，在提交历史中会出现新一次提交记录的时间却比之前提交的时间还要往前这种诡异的记录，所以我希望在我们做了本地修改在提交之前，可以先自动地检验本地的时间是否是正确的，因此我们就需要使用到Git钩子，



